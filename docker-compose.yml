version: '3'

volumes:
  caddy_root: {}
  caddy_etc: {}
  jenkins_home: {}
  jenkins_logs: {}

services:
  caddy:
    restart: always
    image: wemakeservices/caddy-gen:latest
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro
      - caddy_root:/root/.caddy
      - caddy_etc:/etc/caddy
    ports:
      - '80:80'
      - '443:443'

  index:
    restart: always
    image: nginx:latest
    labels:
      - 'virtual.host=sites.async.fi'
      - 'virtual.tls-email=hostmaster@async.fi'
    volumes:
      - ./sites.async.fi:/usr/share/nginx/html:ro

  clock:
    restart: always
    image: nginx:latest
    labels:
      - 'virtual.host=clock.async.fi'
      - 'virtual.tls-email=hostmaster@async.fi'
    volumes:
      - ./clock.async.fi:/usr/share/nginx/html:ro

  oh2ewl:
    restart: always
    image: nginx:latest
    labels:
      - 'virtual.host=oh2ewl.async.fi'
      - 'virtual.tls-email=hostmaster@async.fi'
    volumes:
      - ./oh2ewl.async.fi:/usr/share/nginx/html:ro

  uuid:
    restart: always
    image: gunicorn:latest
    build:
      context: ./gunicorn/
    labels:
      - 'virtual.host=uuid.async.fi'
      - 'virtual.tls-email=hostmaster@async.fi'
    volumes:
      - ./uuid.async.fi:/app:ro

  # ip:
  #   restart: always
  #   image: gunicorn:latest
  #   build:
  #     context: ./gunicorn/
  #   labels:
  #     - 'virtual.host=ip.async.fi'
  #     - 'virtual.tls-email=hostmaster@async.fi'
  #   volumes:
  #     - ./ip.async.fi:/app:ro

  # jenkins:
  #   restart: always
  #   image: jenkinsci/blueocean
  #   labels:
  #     - 'virtual.host=jenkins.async.fi'
  #     - 'virtual.tls-email=hostmaster@async.fi'
  #   volumes:
  #     - jenkins_home:/var/jenkins_home
  #     - jenkins_logs:/var/log/jenkins
